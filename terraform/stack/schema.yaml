## Copyright Â© 2020, Oracle and/or its affiliates.
## All rights reserved. The Universal Permissive License (UPL), Version 1.0 as shown at http://oss.oracle.com/licenses/upl

title: "Deploy Machine Learning Platform on Oracle Cloud Infrastructure Compute instance"
stackDescription: "Deploy Machine Learning Platform on Oracle Cloud Infrastructure Compute instance"
schemaVersion: 1.1.0
version: "20220422"
locale: "en"

variableGroups:
  - title: Hidden
    visible: false
    variables:
      - instance_boot_volume_size
      - instance_boot_volume_vpus
      - instance_flex_shape_memory
      - instance_flex_shape_ocpus

  - title: Required Configuration
    visible: true
    variables:
      - region
      - compartment_ocid
      - availability_domain
      - adb_name
      - adb_display_name
      - adb_password
      - license_model
      - instance_display_name
      - instance_image_source_id
      - instance_shape
      - vcn_ai_vcn_id
      - adb_subnet_type
      - subnet_private_id      
      - subnet_ai_subnet_id
      - ssh_authorized_keys
      - oci_bucket_name
      - show_ai_assistant
      - show_search_tab
      - enable_dify

  - title: Dify Configuration
    visible: ${enable_dify}
    variables:
      - external_api_keys
      - dify_branch
      - dify_bucket_name
      - oci_access_key
      - oci_secret_key

variables:
  region:
    title: Region
    type: oci:identity:region:name
    required: true
    visible: false

  compartment_ocid:
    type: oci:identity:compartment:id
    required: true
    visible: true
    title: "Create in compartment"

  availability_domain:
    type: oci:identity:availabilitydomain:name
    required: true
    visible: true
    title: "Availability domain"
    dependsOn:
      region: ${region}
      compartmentId: ${compartment_ocid}

  adb_name:
    type: string
    required: true
    visible: true
    title: "Database name"

  adb_display_name:
    type: string
    required: false
    visible: true
    title: "Database display name"
    description: "Enter the display name for Autonomous Database (optional)"

  adb_password:
    type: password
    required: true
    visible: true
    title: "Database password"
    description: "Set the password for your Autonomous Database ADMIN user here."
    # renders a second field to re-enter the password for confirmation
    confirmation: true
    pattern: "^(?!.*admin)(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?!.*[\"]).{12,30}$"

  license_model:
    type: enum
    required: true
    visible: true
    title: "Choose license"
    enum:
      - "BRING_YOUR_OWN_LICENSE"
      - "LICENSE_INCLUDED"
    default: "LICENSE_INCLUDED"

  instance_display_name:
    type: string
    required: true
    visible: true
    title: "Compute instance name"

  vcn_ai_vcn_id:
    type: oci:core:vcn:id
    required: true
    visible: true
    title: "VCN"
    description: "Select existing virtual cloud network"
    dependsOn:
      compartmentId: ${compartment_ocid}

  adb_subnet_type:
    type: enum
    required: true
    visible: true
    title: "ADB Subnet Type"
    description: "ADBã®ã‚µãƒ–ãƒãƒƒãƒˆã‚¿ã‚¤ãƒ—ã‚’é¸æŠï¼ˆPrivate Subnetã‚’é¸æŠã™ã‚‹ã¨å°‚ç”¨ã‚µãƒ–ãƒãƒƒãƒˆã‚’æŒ‡å®šã§ãã¾ã™ï¼‰"
    enum:
      - "PUBLIC"
      - "PRIVATE"
    default: "PUBLIC"

  subnet_private_id:
    type: oci:core:subnet:id
    required: true
    visible:
      eq:
        - adb_subnet_type
        - "PRIVATE"
    title: "Private Subnet for ADB"
    description: "ADBç”¨ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆã‚’é¸æŠ"
    dependsOn:
      compartmentId: ${compartment_ocid}
      vcnId: ${vcn_ai_vcn_id}

  subnet_ai_subnet_id:
    type: oci:core:subnet:id
    required: true
    visible: true
    title: "Subnet"
    description: "Select existing subnet"
    dependsOn:
      compartmentId: ${compartment_ocid}
      vcnId: ${vcn_ai_vcn_id}

  ssh_authorized_keys:
    type: oci:core:ssh:publickey
    title: "Add SSH keys"
    description: "Upload a public key that you already have."
    required: true
    visible: true

  oci_bucket_name:
    type: string
    title: "OCI Object Storage Bucket Name"
    description: "ãƒã‚±ãƒƒãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆæ–‡æ›¸ä¿å­˜ç”¨ï¼‰"
    required: true
    visible: true
    default: "semantic-doc-search"

  show_ai_assistant:
    type: boolean
    required: true
    visible: true
    title: "Show AI Assistant"
    description: "AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®è¡¨ç¤ºåˆ¶å¾¡ (true: è¡¨ç¤º, false: éè¡¨ç¤º)"
    default: true

  show_search_tab:
    type: boolean
    required: true
    visible: true
    title: "Show Search Tab"
    description: "ğŸ” æ¤œç´¢ã‚¿ãƒ–ã®è¡¨ç¤ºåˆ¶å¾¡ (true: è¡¨ç¤º, false: éè¡¨ç¤º)"
    default: true

  enable_dify:
    type: boolean
    required: true
    visible: true
    title: "Enable Dify Deployment"
    description: "Enable Dify (Open-source LLM Platform) installation"
    default: false

  external_api_keys:
    type: password
    title: "External API Keys"
    description: "å¤–éƒ¨APIã‚¢ã‚¯ã‚»ã‚¹ç”¨ã®APIã‚­ãƒ¼ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§è¤‡æ•°æŒ‡å®šå¯èƒ½ã€ä¾‹: secred-key-1,secred-key-2,secred-key-3ï¼‰"
    required: true
    visible: ${enable_dify}
    confirmation: false
    default: "secret"

  dify_branch:
    type: string
    required: true
    visible: ${enable_dify}
    title: "Dify Branch/Tag"
    description: "Branch or tag name to clone from Dify repository"
    default: "1.12.1"

  dify_bucket_name:
    type: string
    required: true
    visible: ${enable_dify}
    title: "Dify Bucket Name"
    description: "Object Storage bucket name for Dify"
    default: "dify-bucket"

  oci_access_key:
    type: string
    required: true
    visible: ${enable_dify}
    title: "OCI Access Key"
    description: "OCI Object Storage Access Key (S3 compatibility)"
    confirmation: false
    default: "oci_access_key"

  oci_secret_key:
    type: password
    required: true
    visible: ${enable_dify}
    title: "OCI Secret Key"
    description: "OCI Object Storage Secret Key (S3 compatibility)"
    confirmation: false
    default: "oci_secret_key"

  instance_image_source_id:
    type: enum
    required: true
    visible: true
    title: "Operating System Image"
    description: "Select the OS image according to your region"
    enum:
      - "ocid1.image.oc1.ap-osaka-1.aaaaaaaa7sbmd5q54w466eojxqwqfvvp554awzjpt2behuwsiefrxnwomq5a"
      - "ocid1.image.oc1.ap-tokyo-1.aaaaaaaaoiusqhftxmiyjlulnxx5mdnqfv6pjx4hdcoks3exn7gsrcwpkpdq"
      - "ocid1.image.oc1.us-chicago-1.aaaaaaaal25tbfrlwhh27tzgiatqr3oq5y3qzz7wgpezjouvjk2cdfdr4mnq"
    default: "ocid1.image.oc1.ap-osaka-1.aaaaaaaa7sbmd5q54w466eojxqwqfvvp554awzjpt2behuwsiefrxnwomq5a"

  instance_shape:
    type: enum
    required: true
    visible: true
    title: "Compute Instance Shape"
    description: "Select the shape for compute instance"
    enum:
      - "VM.Standard.E4.Flex"
      - "VM.Standard.E5.Flex"
    default: "VM.Standard.E5.Flex"

  instance_boot_volume_size:
    visible: false
  instance_boot_volume_vpus:
    visible: false
  instance_flex_shape_memory:
    visible: false
  instance_flex_shape_ocpus:
    visible: false

outputs:

  autonomous_data_warehouse_high_connection_string:
    title: "Autonomous Data Warehouse High Connection String"
    displayText: "Autonomous Data Warehouse High Connection String"
    type: copyableString
    visible: true

  ssh_to_instance:
    title: "SSH Command to Instance"
    displayText: "Convenient command to ssh to the instance"
    type: copyableString
    visible: true

  application_url:
    title: "Application URL"
    displayText: "Semantic Document Search Application URL"
    type: copyableString
    visible: true

  document_bucket_name:
    title: "Document Storage Bucket"
    displayText: "Object Storage bucket name for documents"
    type: copyableString
    visible: true

  dify_url:
    title: "Dify URL"
    displayText: "Dify Platform URL (if enabled)"
    type: copyableString
    visible: true

  dify_bucket_name:
    title: "Dify Storage Bucket"
    displayText: "Object Storage bucket name for Dify (if enabled)"
    type: copyableString
    visible: true

  external_api_keys:
    title: "External API Keys"
    displayText: "Configured External API Keys for external access"
    type: copyableString
    visible: true

