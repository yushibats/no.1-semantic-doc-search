<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>資料見つかるくん - セマンティック文書検索システム</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23667eea' stroke-width='2'%3E%3Cpath d='M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cpath d='M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E">
  <link rel="stylesheet" href="/src/style.css">
</head>
<body class="flex flex-col" style="height: 100vh; margin: 0; overflow: hidden;">
  <div id="app" class="flex flex-col" style="height: 100%; overflow: hidden;">
    <!-- ヘッダー -->
    <nav class="apex-header text-white h-16 flex items-center px-6 shadow-lg sticky top-0 z-50">
      <div class="flex items-center gap-3">
        <img src="/assets/images/mitsukarukun.png" alt="資料見つかるくん" class="h-16 object-contain">
        <div class="flex flex-col">
          <span class="font-bold text-lg leading-tight">資料見つかるくん</span>
          <span class="text-xs font-normal opacity-80 leading-tight">管理コンソール</span>
        </div>
      </div>
      
      <div class="ml-auto flex items-center gap-6 text-sm" id="userInfo" style="display: none;">
        <div class="flex items-center gap-3">
          <span class="opacity-90">ユーザー: <span id="userName"></span></span>
          <button onclick="window.authModule.handleLogout()" class="apex-button px-3 py-1 bg-white/15 hover:bg-white/25 border border-white/25 rounded-md transition">ログアウト</button>
        </div>
      </div>
    </nav>

    <!-- タブナビゲーション -->
    <div class="apex-tabs" style="flex-shrink: 0; margin: 0;">
      <div class="apex-tab active" onclick="switchTab('search', event)"><i class="fas fa-search"></i> 検索</div>
      <div class="apex-tab" onclick="switchTab('documents', event)"><i class="fas fa-folder-open"></i> 文書管理</div>
      <div class="apex-tab" onclick="switchTab('admin', event)"><i class="fas fa-cog"></i> 設定</div>
    </div>

    <!-- 設定サブタブ（管理タブがアクティブな時のみ表示） -->
    <div id="adminSubTabs" class="apex-tabs" style="flex-shrink: 0; margin: 0; display: none; background: #f8fafc; border-top: 1px solid #e2e8f0; padding: 0;">
      <div class="apex-tab active" onclick="switchAdminSubTab('database', event)" style="font-size: 14px; padding: 12px 20px; flex: 1; text-align: center;"><i class="fas fa-database"></i> DB管理</div>
      <div class="apex-tab" onclick="switchAdminSubTab('settings', event)" style="font-size: 14px; padding: 12px 20px; flex: 1; text-align: center;"><i class="fas fa-cog"></i> OCI設定</div>
    </div>

    <!-- AI Assistant 浮動ボタン -->
    <button 
      id="copilotToggleBtn"
      class="copilot-float-button"
      onclick="toggleCopilot()"
      style="display: none;"
    >
      <span class="font-bold" style="font-size: 20px;">AI</span>
    </button>

    <!-- AI Assistant パネル -->
    <div id="copilotPanel" class="copilot-panel" style="display: none;">
      <div class="copilot-header">
        <div class="flex items-center gap-2">
          <i class="fas fa-lightbulb w-5 h-5"></i>
          <span class="font-semibold">OCI Generative AI</span>
        </div>
        <div class="flex items-center gap-1">
          <button 
            type="button" 
            class="p-1.5 rounded-full hover:bg-white/10 transition" 
            onclick="startNewConversation()"
            title="新しい会話"
          >
            <i class="fas fa-plus w-4 h-4"></i>
          </button>
          <button 
            type="button" 
            class="p-1.5 rounded-full hover:bg-white/10 transition" 
            onclick="toggleCopilotExpand()"
            title="展開/縮小"
          >
            <i id="copilotExpandIcon" class="fas fa-chevron-right w-4 h-4"></i>
          </button>
          <button 
            type="button" 
            class="p-1.5 rounded-full hover:bg-white/10 transition" 
            onclick="toggleCopilot()"
            title="閉じる"
          >
            <i class="fas fa-times w-4 h-4"></i>
          </button>
        </div>
      </div>
      
      <div class="copilot-messages" id="copilotMessages">
        <div class="text-center text-gray-500 py-8">
          <p class="text-sm">何でもお聞きください！</p>
        </div>
      </div>
      
      <div class="copilot-input-area">
        <form id="copilot-form" onsubmit="event.preventDefault(); sendCopilotMessage();">
          <textarea 
            id="copilotInput" 
            class="copilot-input" 
            placeholder="質問を入力または画像を貼り付け..."
            rows="2"
            onkeydown="handleCopilotKeydown(event)"
          ></textarea>
          <div id="copilotImagesPreview"></div>
          <div class="flex justify-between items-center mt-2">
            <span class="text-xs text-gray-500">Enter で送信 / Shift+Enter で改行</span>
            <div class="flex gap-2">
              <label class="apex-button-secondary px-3 py-1.5 text-xs" style="cursor: pointer; display: inline-flex; align-items: center; gap: 6px;">
                <i class="fas fa-image"></i> 画像
                <input type="file" accept="image/*" multiple style="display:none" onchange="addCopilotImagesFromFiles(this.files); this.value='';" />
              </label>
              <button 
                type="button"
                onclick="document.getElementById('copilotInput').value=''; renderCopilotMessages();"
                class="apex-button-secondary px-3 py-1.5 text-xs"
              >
                <i class="fas fa-trash-alt"></i> クリア
              </button>
              <button 
                type="submit" 
                class="apex-button px-4 py-1.5 text-xs"
                id="copilotSendBtn"
              >
                <i class="fas fa-paper-plane"></i> 送信
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- スクロール可能なコンテンツエリア -->
    <div class="tab-scroll-container" style="flex: 1; overflow-y: auto; background: #f5f7fa; padding: 24px;">

      <!-- 検索タブ -->
      <div id="tab-search" class="tab-content">
      <div class="apex-region" style="margin-bottom: 20px;">
        <div class="apex-region-header">
          <span><i class="fas fa-search"></i> セマンティック検索</span>
        </div>
        <div style="padding: 24px;">
          <!-- 共通フィルター（ファイル名・取得件数・最小スコア） -->
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-bottom: 24px; padding: 16px; background: #f8fafc; border-radius: 8px;">
            <div>
              <label class="form-label">取得件数</label>
              <input type="number" id="topK" class="form-input" value="10" min="1" max="50" />
            </div>
            <div>
              <label class="form-label">最小スコア</label>
              <input type="number" id="minScore" class="form-input" value="0.7" min="0" max="1" step="0.05" />
            </div>
            <div>
              <label class="form-label">ファイル名（任意）</label>
              <input type="text" id="filenameFilter" class="form-input" placeholder="例: AI" />
            </div>
          </div>

          <!-- 検索タイプタブ -->
          <div style="display: flex; gap: 8px; margin-bottom: 20px; border-bottom: 2px solid #e2e8f0;">
            <button 
              id="searchTypeTextTab"
              class="search-type-tab active"
              onclick="window.searchModule.switchSearchType('text')"
              style="padding: 12px 24px; font-weight: 600; font-size: 14px; border: none; background: none; cursor: pointer; border-bottom: 3px solid #1a365d; color: #1a365d; transition: all 0.3s;"
            >
              <i class="fas fa-file-alt"></i> テキスト検索
            </button>
            <button 
              id="searchTypeImageTab"
              class="search-type-tab"
              onclick="window.searchModule.switchSearchType('image')"
              style="padding: 12px 24px; font-weight: 600; font-size: 14px; border: none; background: none; cursor: pointer; border-bottom: 3px solid transparent; color: #64748b; transition: all 0.3s;"
            >
              <i class="fas fa-image"></i> 画像検索
            </button>
          </div>

          <!-- テキスト検索パネル -->
          <div id="textSearchPanel" style="display: block;">
            <div style="margin-bottom: 20px;">
              <label class="form-label">検索クエリ</label>
              <textarea 
                id="searchQuery" 
                class="form-input" 
                placeholder="例: セマンティック検索について"
                rows="3"
                onkeypress="if(event.key==='Enter' && !event.shiftKey) { event.preventDefault(); window.searchModule.performSearch(); }"
              ></textarea>
            </div>

            <div style="display: flex; gap: 12px;">
              <button class="apex-button px-4 py-2" onclick="window.searchModule.performSearch()">
                <i class="fas fa-search"></i> 検索実行
              </button>
              <button class="apex-button-secondary px-4 py-2" onclick="window.searchModule.clearSearchResults()">
                <i class="fas fa-eraser"></i> クリア
              </button>
            </div>
          </div>

          <!-- 画像検索パネル -->
          <div id="imageSearchPanel" style="display: none;">
            <div style="margin-bottom: 20px;">
              <label class="form-label">検索画像</label>
              
              <!-- ファイル選択エリア -->
              <div 
                id="imageSearchDropZone"
                onclick="document.getElementById('searchImageInput').click()"
                style="
                  border: 2px dashed #cbd5e1;
                  border-radius: 8px;
                  padding: 32px;
                  text-align: center;
                  cursor: pointer;
                  background: #f8fafc;
                  transition: all 0.3s;
                  margin-bottom: 12px;
                "
                onmouseover="this.style.borderColor='#1a365d'; this.style.background='#f0f4ff';"
                onmouseout="this.style.borderColor='#cbd5e1'; this.style.background='#f8fafc';"
              >
                <div id="imageSearchPreview" style="display: none;">
                  <img id="searchImagePreviewImg" style="max-width: 100%; max-height: 300px; border-radius: 8px; margin-bottom: 12px;" />
                  <div style="font-size: 14px; color: #64748b; margin-bottom: 8px;">
                    <span id="searchImageFilename"></span>
                  </div>
                  <button 
                    class="apex-button-secondary"
                    onclick="event.stopPropagation(); window.searchModule.clearSearchImage();"
                    style="padding: 6px 16px; font-size: 13px;"
                  >
                    <i class="fas fa-trash-alt"></i> 画像をクリア
                  </button>
                </div>
                <div id="imageSearchPlaceholder">
                  <i class="fas fa-image" style="font-size: 48px; margin: 0 auto 12px; color: #94a3b8; display: block; text-align: center;"></i>
                  <div style="font-size: 15px; font-weight: 600; color: #475569; margin-bottom: 6px;">
                    画像ファイルを選択またはドロップ
                  </div>
                  <div style="font-size: 12px; color: #94a3b8;">
                    PNG, JPG, JPEG (最大10MB)
                  </div>
                </div>
              </div>
              
              <!-- ペースト専用エリア -->
              <div 
                id="imageSearchPasteZone"
                tabindex="0"
                style="
                  border: 2px dashed #94a3b8;
                  border-radius: 8px;
                  padding: 20px;
                  text-align: center;
                  background: #f1f5f9;
                  transition: all 0.3s;
                  cursor: pointer;
                  outline: none;
                "
              >
                <div style="display: flex; align-items: center; justify-content: center; gap: 12px;">
                  <i class="fas fa-clipboard" style="font-size: 32px; color: #64748b;"></i>
                  <div style="text-align: center;">
                    <div style="font-size: 14px; font-weight: 600; color: #475569; margin-bottom: 2px;">
                      Ctrl+V で画像を貼り付け
                    </div>
                    <div style="font-size: 12px; color: #64748b;">
                      このエリアをクリックしてフォーカス後、Ctrl+V を押してください
                    </div>
                  </div>
                </div>
              </div>
              
              <input 
                type="file" 
                id="searchImageInput" 
                accept="image/png,image/jpeg,image/jpg"
                style="display: none;"
                onchange="window.searchModule.handleSearchImageSelect(event)"
              />
            </div>

            <div style="display: flex; gap: 12px;">
              <button class="apex-button px-4 py-2" onclick="window.searchModule.performImageSearch()">
                <i class="fas fa-search"></i> 画像検索実行
              </button>
              <button class="apex-button-secondary px-4 py-2" onclick="window.searchModule.clearSearchResults()">
                <i class="fas fa-eraser"></i> クリア
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- 検索結果 -->
      <div id="searchResults" class="apex-region" style="display: none;">
        <div class="apex-region-header">
          <span><i class="fas fa-chart-bar"></i> 検索結果</span>
          <span id="searchResultsSummary" style="font-size: 13px; font-weight: normal; color: #64748b;"></span>
        </div>
        <div style="padding: 20px;">
          <div id="searchResultsList"></div>
        </div>
      </div>
      </div>

      <!-- 文書管理タブ -->
      <div id="tab-documents" class="tab-content" style="display: none;">
      <!-- アップロード -->
      <div class="apex-region" style="margin-bottom: 20px;">
        <div class="apex-region-header">
          <span><i class="fas fa-cloud-upload-alt"></i> 文書アップロード</span>
        </div>
        <div style="padding: 8px 24px 0 24px;">
          <div class="flex items-center gap-2 text-xs" style="color: #94a3b8;">
            <span>Object Storageへアップロードするファイルを選択してください。</span>
          </div>
        </div>
        <div style="padding: 24px;">
          <div style="margin-bottom: 16px;">
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-800 transition cursor-pointer" 
                 onclick="document.getElementById('fileInputMultiple').click()"
                 ondragover="handleDragOver(event)"
                 ondragleave="handleDragLeave(event)"
                 ondrop="handleDropForMultipleInput(event)">
              <i class="fas fa-cloud-upload-alt text-gray-400" style="font-size: 48px; display: block; margin-bottom: 16px;"></i>
              <p class="text-gray-600 font-medium mb-2">ファイルをドラッグ＆ドロップまたはクリックしてアップロード</p>
              <p class="text-sm text-gray-500">対応形式: PDF, XLSX, XLS, DOCX, DOC, PPT, PPTX, PNG, JPG, JPEG, TXT, MD</p>
              <p class="text-xs text-blue-800 font-semibold mt-2">* 最大10ファイルまで同時アップロード可能</p>
              <input type="file" id="fileInputMultiple" class="hidden" accept=".pdf,.xlsx,.xls,.docx,.doc,.ppt,.pptx,.png,.jpg,.jpeg,.txt,.md" multiple onchange="handleMultipleFileSelect(event)">
            </div>
          </div>
          
          <!-- 選択されたファイルリスト -->
          <div id="selectedFilesList" style="margin-bottom: 16px; display: none;">
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
              <div class="flex items-center justify-between mb-3">
                <span class="text-sm font-semibold text-gray-700">選択されたファイル (<span id="selectedFilesCount">0</span>/10)</span>
                <button onclick="clearMultipleFileSelection()" class="text-xs text-red-600 hover:text-red-800 hover:underline">すべてクリア</button>
              </div>
              <div id="selectedFilesListContent" class="space-y-2"></div>
            </div>
          </div>
          
          <!-- アップロード進捗 -->
          <div id="uploadProgress" style="margin-bottom: 16px; display: none;"></div>
          
          <button class="apex-button px-4 py-2" onclick="uploadMultipleDocuments()" id="uploadMultipleBtn" disabled>
            <i class="fas fa-cloud-upload-alt"></i> アップロード開始
          </button>
        </div>
      </div>

      <!-- 文書リスト -->
      <div class="apex-region">
        <div class="apex-region-header">
          <span><i class="fas fa-folder-open"></i> 登録済み文書</span>
          <div style="display: flex; align-items: center; gap: 8px;">
            <button class="apex-button-secondary apex-button-xs" onclick="refreshDocumentsWithNotification()" style="display: flex; align-items: center; gap: 4px;">
              <i class="fas fa-sync-alt"></i> 再取得
            </button>
            <span id="documentsStatusBadge" class="px-2 py-1 text-xs font-semibold rounded-md" style="background: #e2e8f0; color: #64748b;">未取得</span>
            <span id="documentsFileCountBadge" class="px-2 py-1 text-xs font-semibold rounded-md" style="background: #e2e8f0; color: #64748b;">ファイル: 0件</span>
            <span id="documentsPageImageCountBadge" class="px-2 py-1 text-xs font-semibold rounded-md" style="background: #e2e8f0; color: #64748b;">ページ画像: 0件</span>
          </div>
        </div>
        <div style="padding: 8px 24px 0 24px;">
          <div class="flex items-center gap-2 text-xs" style="color: #94a3b8;">
            <span>登録された文書を検索用にベクトル化してデータベースに格納します。また、登録済み文書の一覧表示・ダウンロード・削除などの管理を行います。</span>
          </div>
        </div>
        <div style="padding: 24px;">
          <!-- 処理進捗表示 (削除・ベクトル化) - 一覧の下に表示 -->
          <div id="processProgress" style="margin-top: 16px; display: none;"></div>

          <div id="documentsList"></div>          
        </div>
        </div>
      </div>

      <!-- OCI設定タブ -->
      <div id="tab-settings" class="tab-content" style="display: none;">
      
      <!-- OCI APIキー設定 -->
      <div class="apex-region bg-gray-50/50" style="margin-bottom: 20px;">
        <div class="apex-region-header">
          <span><i class="fas fa-cog"></i> OCI APIキー設定</span>
          <span id="ociSettingsStatusBadge" class="px-2 py-1 text-xs font-semibold rounded-md" style="background: #e2e8f0; color: #64748b;">未設定</span>
        </div>
        <div style="padding: 8px 24px 0 24px;">
          <div class="flex items-center gap-2 text-xs" style="color: #94a3b8;">
            <span>OCI Generative AI などの OCI リソースにアクセスするための認証情報を設定します。User OCID、Tenancy OCID、Fingerprint、Region、Private Key が必要です。</span>
          </div>
        </div>
        <div class="p-6 space-y-6">
          <div class="bg-white p-5 rounded-lg border border-gray-200">
            <h4 class="text-sm font-semibold text-gray-800 mb-4 pb-2 border-b border-gray-100">
              <i class="fas fa-key"></i> APIキー認証情報
            </h4>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">User OCID*</label>
                <input 
                  type="text" 
                  id="userOcid" 
                  class="w-full font-mono text-sm px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-800 focus:border-blue-800"
                  placeholder="ocid1.user.oc1..aaaa..." 
                />
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Tenancy OCID*</label>
                <input 
                  type="text" 
                  id="tenancyOcid" 
                  class="w-full font-mono text-sm px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-800 focus:border-blue-800"
                  placeholder="ocid1.tenancy.oc1..aaaa..." 
                />
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Fingerprint*</label>
                <input 
                  type="text" 
                  id="fingerprint" 
                  class="w-full font-mono text-sm px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-800 focus:border-blue-800"
                  placeholder="aa:bb:cc:dd:ee:ff:00:11:22:33:44:55:66:77:88:99" 
                />
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Region*</label>
                <select 
                  id="region" 
                  class="w-full font-mono text-sm px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-800 focus:border-blue-800"
                >
                  <option value="ap-osaka-1">ap-osaka-1</option>
                  <option value="us-chicago-1">us-chicago-1</option>
                </select>
              </div>
              
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2">Private Key Content*</label>
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-800 transition cursor-pointer" 
                     onclick="document.getElementById('privateKeyFileInput').click()"
                     ondragover="handleDragOver(event)"
                     ondragleave="handleDragLeave(event)"
                     ondrop="handleDropForInput(event, 'privateKeyFileInput')">
                  <i class="fas fa-cloud-upload-alt text-gray-400" style="font-size: 40px; display: block; margin-bottom: 12px;"></i>
                  <p class="text-gray-600 font-medium mb-1">ファイルをドラッグ＆ドロップまたはクリックしてアップロード</p>
                  <p class="text-sm text-gray-500">対応形式: PEM (.pem, .key)</p>
                  <input type="file" id="privateKeyFileInput" class="hidden" accept=".pem,.key" onchange="handlePrivateKeyFileSelect(event)">
                </div>
                <div id="privateKeyStatus"></div>
              </div>
            </div>
          </div>
          
          <div class="flex items-center gap-3">
            <button 
              onclick="saveOciSettings()" 
              class="apex-button px-6 py-2 bg-blue-800 text-white hover:bg-blue-900 disabled:opacity-50 transition rounded-md shadow-sm font-medium"
            >
              <i class="fas fa-save"></i> APIキーを保存
            </button>
            
            <button 
              onclick="testOciConnection()" 
              class="apex-button-secondary px-6 py-2 bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 disabled:opacity-50 transition rounded-md shadow-sm font-medium"
            >
              <i class="fas fa-flask"></i> 接続テスト
            </button>
          </div>
        </div>
      </div>
      
      <!-- Object Storage設定 -->
      <div class="apex-region">
        <div class="apex-region-header">
          <span><i class="fas fa-box"></i> Object Storage設定</span>
          <div style="display: flex; align-items: center; gap: 8px;">
            <button class="apex-button-secondary apex-button-xs" onclick="refreshObjectStorageSettings()" style="display: flex; align-items: center; gap: 4px;">
              <i class="fas fa-sync-alt"></i> 再取得
            </button>
            <span id="objectStorageStatusBadge" class="px-2 py-1 text-xs font-semibold rounded-md" style="background: #e2e8f0; color: #64748b;">未設定</span>
          </div>
        </div>
        <div style="padding: 8px 24px 0 24px;">
          <div class="flex items-center gap-2 text-xs" style="color: #94a3b8;">
            <span>文書アップロード先のOCI Object Storage バケット情報を設定します。Bucket Name、Namespaceが必要です。</span>
          </div>
        </div>
        <div style="padding: 24px;">

          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 20px;">
            <div class="form-group">
              <label class="form-label">Bucket Name</label>
              <input type="text" id="bucketName" class="form-input" placeholder="OCI_BUCKET 環境変数の値" readonly style="background-color: #f8fafc; cursor: not-allowed;" />
            </div>

            <div class="form-group">
              <label class="form-label">Namespace</label>
              <div style="position: relative;">
                <input type="text" id="namespace" class="form-input" placeholder="自動取得されます" readonly style="background-color: #f8fafc; cursor: not-allowed;" />
                <span id="namespaceStatus" class="text-xs text-gray-500" style="display: block; margin-top: 4px;">環境変数から読み込み中...</span>
              </div>
            </div>
          </div>
          
          <div style="display: flex; gap: 12px;">
            <button class="apex-button-secondary px-4 py-2" onclick="testObjectStorageConnection()">
              <i class="fas fa-flask"></i> 接続テスト
            </button>
          </div>
        </div>
        </div>
      </div>

      <!-- DB管理タブ -->
      <div id="tab-database" class="tab-content" style="display: none;">
      
      <!-- Autonomous AI Database 起動/停止 -->
      <div class="apex-region" style="margin-bottom: 20px;">
        <div class="apex-region-header">
          <span><i class="fas fa-database"></i> Autonomous AI Database 起動/停止</span>
          <div style="display: flex; align-items: center; gap: 8px;">
            <button class="apex-button-secondary apex-button-xs" onclick="getAdbInfo()" style="display: flex; align-items: center; gap: 4px;">
              <i class="fas fa-sync-alt"></i> 再取得
            </button>
            <span id="adbLifecycleState" class="px-2 py-1 text-xs font-semibold rounded-md" style="background: #e2e8f0; color: #64748b;">未取得</span>
          </div>
        </div>
        <div style="padding: 8px 24px 0 24px;">
          <div class="flex items-center gap-2 text-xs" style="color: #94a3b8;">
            <span>データベースの登録や、起動・停止を行います。</span>
          </div>
        </div>
        <div style="padding: 24px;">
          
          <div style="display: flex; gap: 12px; margin-bottom: 20px;">
            <button class="apex-button px-4 py-2" onclick="startAdb()">
              <i class="fas fa-play"></i> 起動
            </button>
            <button class="apex-button-secondary px-4 py-2" onclick="stopAdb()">
              <i class="fas fa-stop"></i> 停止
            </button>
          </div>
          
          <div style="margin-bottom: 20px;">
            <label class="form-label">OCID</label>
            <div id="adbOcid" class="form-input" style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 8px 12px; border-radius: 6px; color: #475569; font-size: 12px; word-break: break-all;">-</div>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
            <div>
              <label class="form-label">表示名</label>
              <div id="adbDisplayName" class="form-input" style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 8px 12px; border-radius: 6px; color: #475569;">-</div>
            </div>
            <div>
              <label class="form-label">ステータス</label>
              <div id="adbLifecycleStateDetail" class="form-input" style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 8px 12px; border-radius: 6px; color: #475569;">-</div>
            </div>
          </div>
          
          <div id="adbOperationResult" style="margin-top: 20px; display: none;">
            <div class="apex-region-header" style="font-size: 14px; padding: 8px 12px;">
              操作結果
            </div>
            <div style="padding: 12px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; margin-top: 8px;">
              <ul id="adbOperationResultList" style="margin: 0; padding-left: 20px; color: #475569; font-size: 13px;">
              </ul>
            </div>
          </div>
        </div>
      </div>
      
      <!-- データベース接続設定 -->
      <div class="apex-region" style="margin-bottom: 20px;">
        <div class="apex-region-header">
          <span><i class="fas fa-plug"></i> データベース接続設定</span>
          <div style="display: flex; align-items: center; gap: 8px;">
            <button class="apex-button-secondary apex-button-xs" onclick="refreshDbConnectionFromEnv()" style="display: flex; align-items: center; gap: 4px;">
              <i class="fas fa-sync-alt"></i> 再取得
            </button>
            <span id="dbConnectionStatusBadge" class="px-2 py-1 text-xs font-semibold rounded-md" style="background: #e2e8f0; color: #64748b;">未取得</span>
          </div>
        </div>
        <div style="padding: 8px 24px 0 24px;">
          <div class="flex items-center gap-2 text-xs" style="color: #94a3b8;">
            <span>Oracle Databaseへの接続情報を設定します。ユーザー名、パスワード、ウォレットファイル（ZIP）を設定してください。</span>
          </div>
        </div>
        <div style="padding: 24px;">

          <!-- 共通フィールド -->
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px;">
            <div class="form-group">
              <label class="form-label">ユーザー名<span class="text-red-500 ml-1">*</span></label>
              <input type="text" id="dbUser" class="form-input" placeholder="username" />
            </div>

            <div class="form-group">
              <label class="form-label">パスワード<span class="text-red-500 ml-1">*</span></label>
              <input type="password" id="dbPassword" class="form-input" placeholder="********" autocomplete="new-password" />
            </div>
          </div>

          <!-- ウォレットアップロード -->
          <div class="form-group" style="margin-bottom: 16px;">
            <label class="form-label">ウォレットファイル<span class="text-red-500 ml-1">*</span></label>
            <div id="walletUploadArea" class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-blue-500 transition-colors" onclick="document.getElementById('walletFileInput').click()">
              <i class="fas fa-cloud-upload-alt text-gray-400" style="font-size: 40px; display: block; margin-bottom: 8px;"></i>
              <div class="text-sm font-medium text-gray-700 mb-1">ファイルをドラッグ&ドロップまたはクリックしてアップロード</div>
              <div class="text-xs text-gray-500">対応形式: ZIP (.zip)</div>
            </div>
            <input type="file" id="walletFileInput" accept=".zip" style="display: none" onchange="handleWalletFileSelect(event)" />
            <div id="walletFileName" class="text-sm text-gray-600 mt-2" style="display: none;"></div>
            <div id="walletStatus" class="text-sm mt-2" style="display: none;"></div>
          </div>

          <!-- サービス名/DSN表示 -->
          <div class="form-group" id="dsnDisplay" style="display: none; margin-bottom: 16px;">
            <label class="form-label">サービス名 / DSN</label>
            <select id="dbDsn" class="form-input">
              <option value="">選択してください</option>
            </select>
          </div>

          <div style="display: flex; gap: 12px; margin-top: 20px;">
            <button type="button" class="apex-button px-4 py-2" onclick="saveDbConnection()">
              <i class="fas fa-save"></i> 接続設定を保存
            </button>
            <button type="button" class="apex-button-secondary px-4 py-2" onclick="testDbConnection()">
              <i class="fas fa-flask"></i> 接続テスト
            </button>
          </div>
        </div>
      </div>

      <!-- データベース情報 -->
      <div class="apex-region" style="margin-bottom: 20px; display: none;">
        <div class="apex-region-header">
          <span><i class="fas fa-chart-bar"></i> データベース情報</span>
          <div style="display: flex; align-items: center; gap: 8px;">
            <button id="refreshDbInfoBtn" class="apex-button-secondary apex-button-xs" onclick="refreshDbInfo()" style="display: flex; align-items: center; gap: 4px;">
              <i class="fas fa-sync-alt"></i> 再取得
            </button>
            <span id="dbInfoStatusBadge" class="px-2 py-1 text-xs font-semibold rounded-md" style="background: #e2e8f0; color: #64748b;">未取得</span>
          </div>
        </div>
        <div style="padding: 8px 24px 0 24px;">
          <div class="flex items-center gap-2 text-xs" style="color: #94a3b8;">
            <span>接続されたデータベースのバージョン、キャラクターセット、その他の基本情報を表示します。</span>
          </div>
        </div>
        <div style="padding: 24px;">
          
          <div id="dbInfoContent">
            <div style="text-align: center; padding: 40px; color: #64748b;">
              <div style="font-size: 48px; margin-bottom: 16px;"><i class="fas fa-database" style="color: #94a3b8;"></i></div>
              <div style="font-size: 16px; font-weight: 500;">データベースに接続してください</div>
              <div style="font-size: 14px; margin-top: 8px;">接続後、データベース情報が表示されます</div>
            </div>
          </div>
        </div>
      </div>

      <!-- ストレージ情報 -->
      <div class="apex-region" style="margin-bottom: 20px; display: none;">
        <div class="apex-region-header">
          <span><i class="fas fa-hdd"></i> ストレージ情報</span>
          <div style="display: flex; align-items: center; gap: 8px;">
            <button id="refreshDbStorageBtn" class="apex-button-secondary apex-button-xs" onclick="refreshDbStorage()" style="display: flex; align-items: center; gap: 4px;">
              <i class="fas fa-sync-alt"></i> 再取得
            </button>
            <span id="dbStorageStatusBadge" class="px-2 py-1 text-xs font-semibold rounded-md" style="background: #e2e8f0; color: #64748b;">未取得</span>
          </div>
        </div>
        <div style="padding: 8px 24px 0 24px;">
          <div class="flex items-center gap-2 text-xs" style="color: #94a3b8;">
            <span>データベースのストレージ使用状況を表示します。テーブルスペースごとの使用状況を確認できます。</span>
          </div>
        </div>
        <div style="padding: 24px;">
          
          <div id="dbStorageContent">
            <div style="text-align: center; padding: 40px; color: #64748b;">
              <div style="font-size: 48px; margin-bottom: 16px;"><i class="fas fa-hdd" style="color: #94a3b8;"></i></div>
              <div style="font-size: 16px; font-weight: 500;">データベースに接続してください</div>
              <div style="font-size: 14px; margin-top: 8px;">接続後、ストレージ情報が表示されます</div>
            </div>
          </div>
        </div>
      </div>

      <!-- テーブル一覧 -->
      <div class="apex-region" style="margin-bottom: 20px;">
        <div class="apex-region-header">
          <span><i class="fas fa-table"></i> テーブル一覧</span>
          <div style="display: flex; align-items: center; gap: 8px;">
            <button id="refreshDbTablesBtn" class="apex-button-secondary apex-button-xs" onclick="refreshDbTables()" style="display: flex; align-items: center; gap: 4px;">
              <i class="fas fa-sync-alt"></i> 再取得
            </button>
            <span id="dbTablesStatusBadge" class="px-2 py-1 text-xs font-semibold rounded-md" style="background: #e2e8f0; color: #64748b;">未取得</span>
          </div>
        </div>
        <div style="padding: 8px 24px 0 24px;">
          <div class="flex items-center gap-2 text-xs" style="color: #94a3b8;">
            <span>接続されたスキーマ内のテーブル一覧を表示します。各テーブルの行数や作成日時を確認できます。</span>
          </div>
        </div>
        <div style="padding: 24px;">
          
          <div id="dbTablesContent">
            <div style="text-align: center; padding: 40px; color: #64748b;">
              <div style="font-size: 48px; margin-bottom: 16px;"><i class="fas fa-table" style="color: #94a3b8;"></i></div>
              <div style="font-size: 16px; font-weight: 500;">テーブル情報なし</div>
              <div style="font-size: 14px; margin-top: 8px;">データベースに接続後、テーブル一覧が表示されます</div>
            </div>
          </div>
        </div>
      </div>

      <!-- テーブルデータプレビューエリア -->
      <div id="tableDataPreview" class="apex-region" style="display: none;"></div>
      </div>
    </div>

  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- ログインオーバーレイ -->
  <div id="loginOverlay" class="login-overlay" style="display: none;" role="dialog" aria-modal="true" aria-label="ログイン">
    <div class="login-bg" aria-hidden="true">
      <div class="login-blob login-blob-1"></div>
      <div class="login-blob login-blob-2"></div>
      <div class="login-blob login-blob-3"></div>
      <div class="login-grid"></div>
      <!-- 右下ウォーターマーク -->
      <div class="login-watermark">
        <img src="/assets/images/mitsukarukun.png" alt="">
      </div>
    </div>
    <div class="login-shell">
      <div class="login-panel">
        <div class="hidden md:flex flex-col items-center justify-center px-2">
          <img src="/assets/images/mitsukarukun.png" alt="資料見つかるくん" class="login-mascot-img">
          <div class="login-mascot-title">資料見つかるくん</div>
          <div class="login-mascot-subtitle">管理コンソール</div>
        </div>

        <div class="login-card">
          <div class="login-card-header">
            <div class="flex items-center justify-between gap-3">
              <div class="text-white">
                <div class="text-xs font-semibold tracking-wide text-white/70">WELCOME BACK</div>
                <div class="text-xl font-semibold tracking-tight">ログイン</div>
              </div>
              <div class="login-badge">AI</div>
            </div>
            <div class="text-sm text-white/70 mt-2">
              このシステムを使用するにはログインが必要です。
            </div>
          </div>

          <div class="login-card-body">
            <div id="loginError" class="login-alert" role="alert" aria-live="polite" style="display: none;">
              <div class="login-alert-icon">!</div>
              <div class="text-sm" id="loginErrorMessage"></div>
            </div>

            <form id="loginForm" class="space-y-4" onsubmit="handleLogin(event)" autocomplete="on">
              <div class="space-y-1.5">
                <label for="loginUsername" class="form-label" style="color: rgba(255,255,255,0.8);">ユーザー名</label>
                <div class="login-input-wrap">
                  <div class="login-input-icon" aria-hidden="true">
                    <i class="fas fa-user w-5 h-5"></i>
                  </div>
                  <input
                    type="text"
                    id="loginUsername"
                    class="form-input login-input"
                    placeholder="ユーザー名を入力"
                    autocomplete="username"
                    inputmode="text"
                    autocapitalize="none"
                    spellcheck="false"
                    autofocus
                    required
                  >
                </div>
              </div>

              <div class="space-y-1.5">
                <label for="loginPassword" class="form-label" style="color: rgba(255,255,255,0.8);">パスワード</label>
                <div class="login-input-wrap">
                  <div class="login-input-icon" aria-hidden="true">
                    <i class="fas fa-lock w-5 h-5"></i>
                  </div>
                  <input
                    type="password"
                    id="loginPassword"
                    class="form-input login-input"
                    placeholder="パスワードを入力"
                    autocomplete="current-password"
                    required
                  >
                  <button
                    type="button"
                    class="login-reveal"
                    onclick="toggleLoginPassword()"
                    aria-label="パスワード表示切替"
                  >
                    <i class="fas fa-eye w-5 h-5"></i>
                  </button>
                </div>
              </div>

              <button
                class="modal-button modal-button-primary w-full justify-center login-submit"
                type="submit"
                id="loginSubmitBtn"
                style="background: #ffffff; color: #0f2847; font-weight: 600;"
              >
                ログイン
              </button>
            </form>

            <div class="text-xs text-white/50 mt-4 leading-relaxed">
              セッション情報はブラウザに保存されます。
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>

  <!-- 確認モーダルはshowModal関数で動的に生成されるため、静的HTMLは不要 -->

  <!-- 共通モジュール -->
  <script type="module" src="/src/config.js"></script>
  <script type="module" src="/src/state.js"></script>
  <script type="module" src="/src/i18n.js"></script>
  <script type="module" src="/src/dom-utils.js"></script>
  
  <!-- 機能モジュール -->
  <script type="module" src="/src/modules/utils.js"></script>
  <script type="module" src="/src/modules/auth.js"></script>
  <script type="module" src="/src/modules/search.js"></script>
  <script type="module" src="/src/modules/oci.js"></script>
  
  <!-- UIコンポーネントとメインアプリ -->
  <script type="module" src="/components.js"></script>
  <script type="module" src="/app.js"></script>
</body>
</html>
